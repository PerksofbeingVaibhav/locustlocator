{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/jappanjeetsingh/Desktop/web/projects/LLAM/LLAM-V2/LLAM/components/Tracking/Tracking.js\";\nimport { useEffect, useState, useRef } from 'react';\nimport axios from \"axios\";\nimport * as Cesium from 'cesium';\nimport CesiumWind from \"./Wind\"; // fetching locust locations\n\nconst fetchData = async () => {\n  let data = [];\n  await axios.get(\"https://services5.arcgis.com/sjP4Ugu5s0dZWLjd/arcgis/rest/services/Swarms_Public/FeatureServer/0/query?where=STARTDATE%20%3E%3D%20TIMESTAMP%20%272021-01-01%2000%3A00%3A00%27%20AND%20STARTDATE%20%3C%3D%20TIMESTAMP%20%272021-04-04%2000%3A00%3A00%27&outFields=STARTDATE,LOCNAME,COUNTRYID,LOCPRESENT&outSR=4326&f=json\").then(response => {\n    response.data.features.map(pos => {\n      console.log(pos);\n      data.push({\n        longitude: pos.geometry.x,\n        latitude: pos.geometry.y\n      });\n    });\n  });\n  return data;\n};\n\nconst usePrevious = value => {\n  // The ref object is a generic container whose current property is mutable ...\n  // ... and can hold any value, similar to an instance property on a class\n  console.log(value);\n  const ref = useRef(); // Store current value in ref\n\n  useEffect(() => {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n  // Return previous value (happens before update in useEffect above)\n\n  return ref.current;\n};\n\nconst Tracking = () => {\n  const {\n    0: predictedData,\n    1: setPredictedData\n  } = useState(null);\n  const {\n    0: displayMessage,\n    1: setDisplayMessage\n  } = useState(\"\");\n  const {\n    0: longitude,\n    1: setLongitude\n  } = useState(\"\");\n  const {\n    0: latitude,\n    1: setLatitude\n  } = useState(\"\");\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n\n  const init = locationData => {\n    // default view over India\n    var west = 68.0;\n    var south = 7.0;\n    var east = 89.0;\n    var north = 35.0;\n    var indiaPosition = Cesium.Rectangle.fromDegrees(west, south, east, north);\n    Cesium.Camera.DEFAULT_VIEW_FACTOR = 1.2;\n    Cesium.Camera.DEFAULT_VIEW_RECTANGLE = indiaPosition;\n    var imagery = Cesium.createDefaultImageryProviderViewModels(); // initialize viewer\n\n    const viewer = new Cesium.Viewer(\"cesium\", {\n      scene3DOnly: false,\n      selectionIndicator: true,\n      imageryProviderViewModels: imagery,\n      selectedImageryProviderViewModel: imagery[1],\n      animation: false,\n      timeline: false // automaticallyTrackDataSourceClocks: false\n\n    }); // viewer.imageryLayers.addImageryProvider(provider);\n    // enabling lighting effects due to sun\n    // adding sentinel 2a, meteo 10 and spot 6 satellite realtime visualization\n\n    viewer.dataSources.removeAll();\n    var dataSrc = Cesium.CzmlDataSource.load(\"sat.czml\");\n    viewer.dataSources.add(dataSrc);\n    var loaded = false;\n\n    function checkLoad() {\n      if (!loaded) {\n        var numTiles = viewer.scene.globe._surface._tileLoadQueue.length;\n        console.log(numTiles);\n\n        if (numTiles === 0) {\n          loaded = true; // Hide the loading overlay.\n\n          document.getElementById(\"loading-overlay\").style.display = \"none\";\n        } else {\n          setTimeout(checkLoad, 100);\n        }\n      }\n    } // var editHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);\n    // editHandler.setInputAction(function (e) {\n    //   var shapeEditMenu = document.getElementById(\"toolbar\");\n    //   shapeEditMenu.textContent = 'Testing';\n    //   shapeEditMenu.style.display = \"block\";\n    //   shapeEditMenu.style.left = e.position.x + 'px';\n    //   shapeEditMenu.style.top = e.position.y + 'px';\n    //   shapeEditMenu.style.background = 'rgba(42, 42, 42, 0.8)';\n    //   shapeEditMenu.style.border = '1px solid #888';\n    // }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\n    // editHandler.setInputAction(function (e) {\n    //   var shapeEditMenu = document.getElementById(\"toolbar\");\n    //   shapeEditMenu.style.display = \"none\";\n    // }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\n    // adding predicted point\n    // if (prediction) {\n    //   viewer.entities.add({\n    //     position: Cesium.Cartesian3.fromDegrees(parseInt(longitude), parseInt(latitude)),\n    //     point: {\n    //       pixelSize: 30,\n    //       color: Cesium.Color.CRIMSON.withAlpha(0.4),\n    //     },\n    //   });\n    // }\n    // populating locust locations on globe\n\n\n    var billboards = viewer.scene.primitives.add(new Cesium.BillboardCollection());\n    {\n      locationData.map(coords => {\n        billboards.add({\n          position: Cesium.Cartesian3.fromDegrees(coords.longitude, coords.latitude),\n          image: '/Assets/Images/locust.png'\n        });\n      });\n    } // adding position marker\n\n    var entity = viewer.entities.add({\n      name: \"location\",\n      label: {\n        show: false,\n        showBackground: true,\n        font: \"14px monospace\",\n        style: Cesium.LabelStyle.FILL_AND_OUTLINE,\n        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,\n        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\n        pixelOffset: new Cesium.Cartesian2(0, -9)\n      }\n    }); // showing position popup on mouse move\n\n    viewer.canvas.addEventListener('mousemove', function (e) {\n      var mousePosition = new Cesium.Cartesian2(e.clientX, e.clientY);\n      var ellipsoid = viewer.scene.globe.ellipsoid;\n      var cartesian = viewer.camera.pickEllipsoid(mousePosition, ellipsoid);\n\n      if (cartesian) {\n        var cartographic = ellipsoid.cartesianToCartographic(cartesian);\n        var longitudeString = Cesium.Math.toDegrees(cartographic.longitude).toFixed(2);\n        var latitudeString = Cesium.Math.toDegrees(cartographic.latitude).toFixed(2);\n        entity.position = cartesian;\n        entity.label.show = true;\n        entity.label.text = \"Lon: \" + (\"   \" + longitudeString).slice(-7) + \"\\u00B0\" + \"\\nLat: \" + (\"   \" + latitudeString).slice(-7) + \"\\u00B0\";\n      } else {\n        entity.label.show = false;\n      }\n    }, false); // Visualizing wind on the globe\n\n    const windOptions = {\n      colorScale: ['rgb(36,104, 180)', 'rgb(60,157, 194)', 'rgb(128,205,193 )', 'rgb(151,218,168 )', 'rgb(198,231,181)', 'rgb(238,247,217)', 'rgb(255,238,159)', 'rgb(252,217,125)', 'rgb(255,182,100)', 'rgb(252,150,75)', 'rgb(250,112,52)', 'rgb(245,64,32)', 'rgb(237,45,28)', 'rgb(220,24,32)', 'rgb(180,0,35)'],\n      frameRate: 16,\n      maxAge: 60,\n      globalAlpha: 0.9,\n      velocityScale: 1 / 30,\n      paths: 2000\n    };\n    fetch('https://qjvic.github.io/cesium-wind/examples/wind.json').then(res => res.json()).then(res => {\n      const windLayer = new CesiumWind(res, {\n        windOptions\n      });\n      windLayer.addTo(viewer);\n    }); // setTimeout(checkLoad, 2000);\n  };\n\n  useEffect(async () => {\n    const locationData = await fetchData(); // const prediction = await predictedData\n\n    init(locationData);\n  }, []);\n  const prevLat = usePrevious(latitude);\n  const prevLong = usePrevious(longitude); // const prevPredictedData = usePrevious(predictedData);\n\n  const onFormSubmitHandler = event => {\n    event.preventDefault();\n    console.log(\"Longitude: \" + longitude);\n    console.log(\"Latitude: \" + latitude);\n    let lat = latitude;\n    let long = longitude;\n\n    if (lat === \"\" && long === \"\") {\n      setPredictedData({\n        risk: NaN\n      });\n    } else if (prevLat === lat && prevLong === long) {\n      console.log(\"lat and long matched with prev values\");\n    } else {\n      let data = `lat-${lat}-long-${long}`;\n      setLoading(true);\n      axios.post(`https://landcoverapi.azurewebsites.net/predict/${data}`).then(response => {\n        setLoading(false);\n        setDisplayMessage(\"Predicted Probability = \");\n        setPredictedData(response.data); // plotPredictedPoint(longitude, latitude)\n      });\n    }\n  };\n\n  const onResetHandler = event => {\n    event.preventDefault();\n    setDisplayMessage(\"\");\n    setLongitude(\"\");\n    setLatitude(\"\");\n    setLoading(false);\n    setPredictedData(null);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"cesium\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"loading-overlay\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"toolbar\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      id: \"location-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Predicting Probability of Attack\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"longitude\",\n        children: \"longitude: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        name: \"long\",\n        value: longitude,\n        onChange: e => setLongitude(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"latitude\",\n        children: \"latitude: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        name: \"lat\",\n        value: latitude,\n        onChange: e => setLatitude(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onFormSubmitHandler,\n        children: \"Predict\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onResetHandler,\n        children: \"Reset\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 20\n      }, this) : null, predictedData ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [displayMessage, \" \", predictedData.risk.toFixed(2), \"%\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 26\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\nexport default Tracking;","map":{"version":3,"sources":["/Users/jappanjeetsingh/Desktop/web/projects/LLAM/LLAM-V2/LLAM/components/Tracking/Tracking.js"],"names":["useEffect","useState","useRef","axios","Cesium","CesiumWind","fetchData","data","get","then","response","features","map","pos","console","log","push","longitude","geometry","x","latitude","y","usePrevious","value","ref","current","Tracking","predictedData","setPredictedData","displayMessage","setDisplayMessage","setLongitude","setLatitude","loading","setLoading","init","locationData","west","south","east","north","indiaPosition","Rectangle","fromDegrees","Camera","DEFAULT_VIEW_FACTOR","DEFAULT_VIEW_RECTANGLE","imagery","createDefaultImageryProviderViewModels","viewer","Viewer","scene3DOnly","selectionIndicator","imageryProviderViewModels","selectedImageryProviderViewModel","animation","timeline","dataSources","removeAll","dataSrc","CzmlDataSource","load","add","loaded","checkLoad","numTiles","scene","globe","_surface","_tileLoadQueue","length","document","getElementById","style","display","setTimeout","billboards","primitives","BillboardCollection","coords","position","Cartesian3","image","entity","entities","name","label","show","showBackground","font","LabelStyle","FILL_AND_OUTLINE","horizontalOrigin","HorizontalOrigin","LEFT","verticalOrigin","VerticalOrigin","BOTTOM","pixelOffset","Cartesian2","canvas","addEventListener","e","mousePosition","clientX","clientY","ellipsoid","cartesian","camera","pickEllipsoid","cartographic","cartesianToCartographic","longitudeString","Math","toDegrees","toFixed","latitudeString","text","slice","windOptions","colorScale","frameRate","maxAge","globalAlpha","velocityScale","paths","fetch","res","json","windLayer","addTo","prevLat","prevLong","onFormSubmitHandler","event","preventDefault","lat","long","risk","NaN","post","onResetHandler","target"],"mappings":"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","sourcesContent":["import { useEffect, useState, useRef } from 'react';\nimport axios from \"axios\"\nimport * as Cesium from 'cesium';\nimport CesiumWind from \"./Wind\";\n\n// fetching locust locations\nconst fetchData = async () => {\n  let data = []\n  await axios.get(\"https://services5.arcgis.com/sjP4Ugu5s0dZWLjd/arcgis/rest/services/Swarms_Public/FeatureServer/0/query?where=STARTDATE%20%3E%3D%20TIMESTAMP%20%272021-01-01%2000%3A00%3A00%27%20AND%20STARTDATE%20%3C%3D%20TIMESTAMP%20%272021-04-04%2000%3A00%3A00%27&outFields=STARTDATE,LOCNAME,COUNTRYID,LOCPRESENT&outSR=4326&f=json\")\n    .then(response => {\n      response.data.features.map(pos => {\n        console.log(pos)\n        data.push({\n          longitude: pos.geometry.x,\n          latitude: pos.geometry.y\n        })\n      })\n    })\n  return data\n}\n\nconst usePrevious = (value) => {\n  // The ref object is a generic container whose current property is mutable ...\n  // ... and can hold any value, similar to an instance property on a class\n  console.log(value)\n  const ref = useRef();\n  // Store current value in ref\n  useEffect(() => {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n  // Return previous value (happens before update in useEffect above)\n  return ref.current;\n}\n\n\nconst Tracking = () => {\n\n  const [predictedData, setPredictedData] = useState(null)\n  const [displayMessage, setDisplayMessage] = useState(\"\")\n  const [longitude, setLongitude] = useState(\"\")\n  const [latitude, setLatitude] = useState(\"\")\n  const [loading, setLoading] = useState(false)\n\n  const init = (locationData) => {\n    // default view over India\n    var west = 68.0;\n    var south = 7.0;\n    var east = 89.0;\n    var north = 35.0;\n\n    var indiaPosition = Cesium.Rectangle.fromDegrees(west, south, east, north);\n\n    Cesium.Camera.DEFAULT_VIEW_FACTOR = 1.2;\n    Cesium.Camera.DEFAULT_VIEW_RECTANGLE = indiaPosition;\n\n    var imagery = Cesium.createDefaultImageryProviderViewModels();\n\n    // initialize viewer\n    const viewer = new Cesium.Viewer(\"cesium\", {\n      scene3DOnly: false,\n      selectionIndicator: true,\n      imageryProviderViewModels: imagery,\n      selectedImageryProviderViewModel: imagery[1],\n      animation: false,\n      timeline: false,\n      // automaticallyTrackDataSourceClocks: false\n    });\n\n    // viewer.imageryLayers.addImageryProvider(provider);\n    // enabling lighting effects due to sun\n\n    // adding sentinel 2a, meteo 10 and spot 6 satellite realtime visualization\n    viewer.dataSources.removeAll();\n    var dataSrc = Cesium.CzmlDataSource.load(\"sat.czml\");\n    viewer.dataSources.add(dataSrc);\n\n    var loaded = false;\n\n    function checkLoad() {\n      if (!loaded) {\n        var numTiles = viewer.scene.globe._surface._tileLoadQueue.length;\n        console.log(numTiles);\n        if (numTiles === 0) {\n          loaded = true;\n          // Hide the loading overlay.\n          document.getElementById(\"loading-overlay\").style.display = \"none\";\n        }\n        else {\n          setTimeout(checkLoad, 100);\n        }\n      }\n    }\n    // var editHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);\n    // editHandler.setInputAction(function (e) {\n    //   var shapeEditMenu = document.getElementById(\"toolbar\");\n    //   shapeEditMenu.textContent = 'Testing';\n    //   shapeEditMenu.style.display = \"block\";\n    //   shapeEditMenu.style.left = e.position.x + 'px';\n    //   shapeEditMenu.style.top = e.position.y + 'px';\n    //   shapeEditMenu.style.background = 'rgba(42, 42, 42, 0.8)';\n    //   shapeEditMenu.style.border = '1px solid #888';\n    // }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\n\n    // editHandler.setInputAction(function (e) {\n    //   var shapeEditMenu = document.getElementById(\"toolbar\");\n    //   shapeEditMenu.style.display = \"none\";\n    // }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\n\n\n    // adding predicted point\n    // if (prediction) {\n    //   viewer.entities.add({\n    //     position: Cesium.Cartesian3.fromDegrees(parseInt(longitude), parseInt(latitude)),\n    //     point: {\n    //       pixelSize: 30,\n    //       color: Cesium.Color.CRIMSON.withAlpha(0.4),\n    //     },\n    //   });\n    // }\n\n    // populating locust locations on globe\n    var billboards = viewer.scene.primitives.add(new Cesium.BillboardCollection());\n    {\n      locationData.map(coords => {\n        billboards.add({\n          position: Cesium.Cartesian3.fromDegrees(coords.longitude, coords.latitude),\n          image: '/Assets/Images/locust.png'\n        });\n      })\n    }\n\n    // adding position marker\n    var entity = viewer.entities.add({\n      name: \"location\",\n      label: {\n        show: false,\n        showBackground: true,\n        font: \"14px monospace\",\n        style: Cesium.LabelStyle.FILL_AND_OUTLINE,\n        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,\n        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\n        pixelOffset: new Cesium.Cartesian2(0, -9),\n      },\n    });\n\n    // showing position popup on mouse move\n    viewer.canvas.addEventListener('mousemove', function (e) {\n\n      var mousePosition = new Cesium.Cartesian2(e.clientX, e.clientY);\n      var ellipsoid = viewer.scene.globe.ellipsoid;\n      var cartesian = viewer.camera.pickEllipsoid(mousePosition, ellipsoid);\n\n      if (cartesian) {\n        var cartographic = ellipsoid.cartesianToCartographic(cartesian);\n        var longitudeString = Cesium.Math.toDegrees(cartographic.longitude).toFixed(2);\n        var latitudeString = Cesium.Math.toDegrees(cartographic.latitude).toFixed(2);\n\n        entity.position = cartesian;\n        entity.label.show = true;\n        entity.label.text = \"Lon: \" +\n          (\"   \" + longitudeString).slice(-7) +\n          \"\\u00B0\" +\n          \"\\nLat: \" +\n          (\"   \" + latitudeString).slice(-7) +\n          \"\\u00B0\";\n\n      } else {\n        entity.label.show = false;\n      }\n\n    }, false);\n\n    // Visualizing wind on the globe\n    const windOptions = {\n      colorScale: [\n        'rgb(36,104, 180)',\n        'rgb(60,157, 194)',\n        'rgb(128,205,193 )',\n        'rgb(151,218,168 )',\n        'rgb(198,231,181)',\n        'rgb(238,247,217)',\n        'rgb(255,238,159)',\n        'rgb(252,217,125)',\n        'rgb(255,182,100)',\n        'rgb(252,150,75)',\n        'rgb(250,112,52)',\n        'rgb(245,64,32)',\n        'rgb(237,45,28)',\n        'rgb(220,24,32)',\n        'rgb(180,0,35)',\n      ],\n      frameRate: 16,\n      maxAge: 60,\n      globalAlpha: 0.9,\n      velocityScale: 1 / 30,\n      paths: 2000\n    };\n\n    fetch('https://qjvic.github.io/cesium-wind/examples/wind.json')\n      .then(res => res.json())\n      .then(res => {\n        const windLayer = new CesiumWind(res, { windOptions });\n        windLayer.addTo(viewer);\n      });\n    // setTimeout(checkLoad, 2000);\n  }\n\n  useEffect(async () => {\n    const locationData = await fetchData()\n    // const prediction = await predictedData\n    init(locationData);\n  }, [])\n\n  const prevLat = usePrevious(latitude);\n  const prevLong = usePrevious(longitude);\n  // const prevPredictedData = usePrevious(predictedData);\n\n  const onFormSubmitHandler = (event) => {\n    event.preventDefault();\n    console.log(\"Longitude: \" + longitude)\n    console.log(\"Latitude: \" + latitude)\n    let lat = latitude\n    let long = longitude\n\n    if (lat === \"\" && long === \"\") {\n      setPredictedData({ risk: NaN })\n    }\n    else if (prevLat === lat && prevLong === long) {\n      console.log(\"lat and long matched with prev values\")\n    }\n    else {\n      let data = `lat-${lat}-long-${long}`\n      setLoading(true)\n      axios.post(`https://landcoverapi.azurewebsites.net/predict/${data}`)\n        .then(response => {\n          setLoading(false)\n          setDisplayMessage(\"Predicted Probability = \")\n          setPredictedData(response.data)\n          // plotPredictedPoint(longitude, latitude)\n        })\n    }\n  }\n\n  const onResetHandler = (event) => {\n    event.preventDefault();\n    setDisplayMessage(\"\")\n    setLongitude(\"\")\n    setLatitude(\"\")\n    setLoading(false)\n    setPredictedData(null)\n  }\n\n  return (\n    <>\n      <div id=\"cesium\" />\n      <div id=\"loading-overlay\"></div>\n      <div id=\"toolbar\" />\n      <form id=\"location-form\">\n        <h2>Predicting Probability of Attack</h2>\n        <label htmlFor=\"longitude\">longitude: </label>\n        <input type=\"text\" name=\"long\" value={longitude} onChange={(e) => setLongitude(e.target.value)} />\n        <br />\n        <label htmlFor=\"latitude\">latitude: </label>\n        <input type=\"text\" name=\"lat\" value={latitude} onChange={(e) => setLatitude(e.target.value)} />\n        <br />\n        <button onClick={onFormSubmitHandler}>Predict</button>\n        <button onClick={onResetHandler}>Reset</button>\n        {loading ? <p>Loading...</p> : null}\n        {predictedData ? <p>{displayMessage} {predictedData.risk.toFixed(2)}%</p> : null}\n      </form>\n    </>\n  );\n}\n\nexport default Tracking;"]},"metadata":{},"sourceType":"module"}